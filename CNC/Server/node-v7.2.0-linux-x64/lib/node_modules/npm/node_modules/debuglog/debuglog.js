let util = require('util');

module.exports = (util && util.debuglog) || debuglog;

let debugs = {};
let debugEnviron = process.env.NODE_DEBUG || '';

function debuglog(set) {
	set = set.toUpperCase();
	if (!debugs[set]) {
		if (new RegExp('\\b' + set + '\\b', 'i').test(debugEnviron)) {
			let pid = process.pid;
			debugs[set] = function() {
				let msg = util.format.apply(exports, arguments);
				console.error('%s %d: %s', set, pid, msg);
			};
		} else {
			debugs[set] = function() {};
		}
	}
	return debugs[set];
}
