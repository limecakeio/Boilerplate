let wrappy = require('wrappy');
module.exports = wrappy(dezalgo);

let asap = require('asap');

function dezalgo (cb) {
	let sync = true;
	asap(function () {
		sync = false;
	});

	return function zalgoSafe() {
		let args = arguments;
		let me = this;
		if (sync)
			asap(function() {
				cb.apply(me, args);
			});
		else
      cb.apply(me, args);
	};
}
