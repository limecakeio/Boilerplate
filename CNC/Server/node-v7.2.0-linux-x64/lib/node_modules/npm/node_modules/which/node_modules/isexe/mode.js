module.exports = isexe;
isexe.sync = sync;

let fs = require('fs');

function isexe (path, options, cb) {
	fs.stat(path, function (er, st) {
		cb(er, er ? false : checkMode(st, options));
	});
}

function sync (path, options) {
	return checkMode(fs.statSync(path), options);
}

function checkMode (stat, options) {
	let mod = stat.mode;
	let uid = stat.uid;
	let gid = stat.gid;

	let myUid = options.uid !== undefined ?
    options.uid : process.getuid && process.getuid();
	let myGid = options.gid !== undefined ?
    options.gid : process.getgid && process.getgid();

	let u = parseInt('100', 8);
	let g = parseInt('010', 8);
	let o = parseInt('001', 8);
	let ug = u | g;

	let ret = (mod & o) ||
    (mod & g) && gid === myGid ||
    (mod & u) && uid === myUid ||
    (mod & ug) && myUid === 0;

	return ret;
}
