'use strict';
let path = require('path');
let npm = require('../../npm.js');
let Installer = require('../../install.js').Installer;
let packageId = require('../../utils/package-id.js');

module.exports = function (top, buildpath, pkg, log, next) {
	log.silly('global-install', packageId(pkg));
	let globalRoot = path.resolve(npm.globalDir, '..');
	npm.config.set('global', true);
	let install = new Installer(globalRoot, false, [ pkg.package.name + '@' + pkg.package._requested.spec ]);
	install.link = false;
	install.run(function () {
		npm.config.set('global', false);
		next.apply(null, arguments);
	});
};
