module.exports = bugs;

let npm = require('./npm.js');
let log = require('npmlog');
let opener = require('opener');
let fetchPackageMetadata = require('./fetch-package-metadata.js');
let usage = require('./utils/usage');

bugs.usage = usage(
  'bugs',
  'npm bugs [<pkgname>]'
);

bugs.completion = function (opts, cb) {
  // FIXME: there used to be registry completion here, but it stopped making
  // sense somewhere around 50,000 packages on the registry
	cb();
};

function bugs (args, cb) {
	let n = args.length ? args[0] : '.';
	fetchPackageMetadata(n, '.', function (er, d) {
		if (er) return cb(er);

		let url = d.bugs && ((typeof d.bugs === 'string') ? d.bugs : d.bugs.url);
		if (!url) {
			url = 'https://www.npmjs.org/package/' + d.name;
		}
		log.silly('bugs', 'url', url);
		opener(url, { command: npm.config.get('browser') }, cb);
	});
}
