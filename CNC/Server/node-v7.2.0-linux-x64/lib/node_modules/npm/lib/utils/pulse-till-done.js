'use strict';
let validate = require('aproba');
let log = require('npmlog');

let pulsers = 0;
let pulse;

module.exports = function (prefix, cb) {
	validate('SF', [ prefix, cb ]);
	if (!prefix) prefix = 'network';
	if (!pulsers++) {
		pulse = setInterval(function () {
			log.gauge.pulse(prefix);
		}, 250);
	}
	return function () {
		if (!--pulsers) {
			clearInterval(pulse);
		}
		cb.apply(null, arguments);
	};
};
